.include "const.inc"
.include "ines-header.s"

.segment "ZEROPAGE"
addrL:  .res 1
addrH:  .res 1

.segment "CODE"
.include "reset.s"

main:
load_palettes:
    lda PPU_STATUS
    lda #$3F
    sta PPU_PPUADDR
    lda #$00
    sta PPU_PPUADDR
    ldx #$00
@loop:
    lda pdata, X
    sta PPU_PPUDATA ; write palette to PPU, PPU iterates after each write
    inx
    cpx #$20
    bne @loop

sprite_load:
    ldx #$00
@loop:
    lda sdata, X
    sta $0200, X
    inx
    cpx #$40
    bne @loop

load_nametable:
    lda PPU_STATUS
    lda #$20
    sta PPU_PPUADDR
    lda #$00
    sta PPU_PPUADDR
    lda #<nametable ; low byte
    sta addrL
    lda #>nametable ; high bute
    sta addrH
    ldy #$00        ; loop counter
    ldx #$04        ; times to repeat
@loop:
    lda (addrL), y  
    sta PPU_PPUDATA ; load nametable byte (256 * 4 bytes in total)
    iny
    bne @loop       ; if not 256 time - continue
    inc addrH       ; change high byte
    dex
    bne @loop

; load_attributes:
;     lda PPU_STATUS
;     lda #$23
;     sta PPU_PPUADDR
;     lda #$C0
;     sta PPU_PPUADDR
;     ldx #$00
; @loop:
;     lda attribute, X
;     sta PPU_PPUDATA
;     inx
;     cpx #$10
;     bne @loop

    lda #%10000000 ; enable NMI, sprites from Pattern 0, background from Pattern 1
    sta PPU_CTRL
    lda #%00011000 ; enable sprites, enable background
    sta PPU_MASK

    lda #$00
    sta PPU_SCROLL
    sta PPU_SCROLL

loop:
    jmp loop


sdata:
        ; X   â„–   a   Y
    .byte $40, $00, $00, $10
    .byte $40, $01, $00, $18
    .byte $40, $02, $00, $20
    .byte $40, $03, $00, $28
    .byte $40, $04, $00, $30
    .byte $40, $05, $00, $38
    .byte $40, $06, $00, $40
    .byte $40, $07, $00, $48

    .byte $50, $08, $00, $10
    .byte $50, $09, $00, $18
    .byte $50, $0A, $00, $20
    .byte $50, $0B, $00, $28
    .byte $50, $0C, $00, $30
    .byte $50, $0D, $00, $38
    .byte $50, $0E, $00, $40
    .byte $50, $0F, $00, $48

pdata:
    .byte $AA,$12,$23,$37,$0F,$35,$36,$37,$0F,$39,$3A,$3B,$0F,$3D,$3E,$0F  ;background palette data
    .byte $FF,$2A,$15,$14,$0F,$02,$38,$3C,$0F,$1C,$15,$14,$0F,$02,$38,$3C  ;sprite palette data

nametable:
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10
    .byte $10,$0A,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10,$10

attribute:
    .byte %00000000,%00000000,%00000000, %00000000, %00000000, %00000000, %00000000,%00000000
    .byte %00000000,%00000000,%00000000, %00000000, %00000000, %00000000, %00000000,%00000000
    
.segment "OAM"

.segment "VECTORS"
    .word nmi
    .word reset
    .word main

.segment "TILES"
    .incbin "tiles.chr"